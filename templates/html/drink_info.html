<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.31.0/dist/umd/supabase.min.js"></script>
    <link rel="stylesheet" href="/static/css/drink_info.css" type="text/css">
    <title>Wine Detail</title>
</head>
<body>
    <div class="container">
        <div class="tag">네비올로</div>
        <div class="section-title" id="wineName">Gaja<br>Barbaresco</div>
        <div class="rating">
            <span class="score" id="wineScore">★4.7</span>
            <span class="reviews">(1,234)</span>
        </div>
        <div class="product-details">
            <div class="attributes">
                <div class="attribute">
                    <img src="/static/img/body.png" alt="Body icon" class="attribute-icon">
                    <div class="attribute-info">
                        <span>바디감</span>
                        <span class="attribute-value" id="wineBody">Medium</span>
                    </div>
                </div>
                <div class="attribute">
                    <img src="/static/img/brix.png" alt="Sweetness icon" class="attribute-icon">
                    <div class="attribute-info">
                        <span>당도</span>
                        <span class="attribute-value" id="wineSweetness">Dry</span>
                    </div>
                </div>
                <div class="attribute">
                    <img src="/static/img/alcohol.png" alt="Alcohol icon" class="attribute-icon">
                    <div class="attribute-info">
                        <span>알코올</span>
                        <span class="attribute-value" id="wineAlcohol">14.5%</span>
                    </div>
                </div>
            </div>
            <img src="/static/img/Wine_Bottle_PNG_Clip_Art_Image-1699521608.png" alt="Wine bottle" class="product-image">
        </div>
        <div class="main-section">
            <div class="description">
                <div class="description-title">설명</div>
                <div class="description-text" id="wineDescription">
                    이탈리아 피에몬테 지역의 바르바레스코 와인은 복합적인 아로마와 강한 탄닌, 높은 산미가 특징입니다.
                </div>
                <div class="price">
                    <span class="amount" id="winePrice">173,400</span><span class="currency">원</span>
                </div>
                <div class="buy-button">최저가 구매하기</div>
            </div>
        </div> 
    </div>        

    <script>
        // Supabase 초기화 함수
        const supabaseUrl = 'https://kovzqlclzpduuxejjxwf.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtvdnpxbGNsenBkdXV4ZWpqeHdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTg1NTE4NTEsImV4cCI6MjAzNDEyNzg1MX0.A4Vn0QJMKnMe4HAZnT-aEa2r0fL4jHOpKoRHmbls8fQ';

        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

        // setOCRResult 함수 정의
        async function setOCRResult(ocrText) {
            try {
                const { data, error } = await supabase
                    .from('wines')
                    .select('*')
                    .ilike('name', `%${ocrText}%`)
                    .single();

                if (error) {
                    console.error('Error fetching wine data:', error.message || error);
                    alert('와인 정보를 가져오는 데 실패했습니다.');
                    return;
                }

                if (data) {
                    document.getElementById('wineName').innerText = data.name;
                    document.getElementById('wineDescription').innerText = data.description;
                    document.getElementById('winePrice').innerText = data.price + '원';
                    document.getElementById('wineBody').innerText = data.body;
                    document.getElementById('wineSweetness').innerText = data.sweetness;
                    document.getElementById('wineAlcohol').innerText = data.alcohol + '%';
                } else {
                    alert('해당하는 와인 정보를 찾을 수 없습니다.');
                }
            } catch (e) {
                console.error('Error:', e.message || e);
            }
        }

        // 초기화 후 OCR 결과를 처리할 수 있도록 준비
        document.addEventListener('DOMContentLoaded', function() {
            window.setOCRResult = setOCRResult;
        });
    </script>
</body>
</html>
