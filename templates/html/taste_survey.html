<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Wine Preference</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Pretendard Variable', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #ffffff;
        }

        .slider {
            display: flex;
            overflow-x: scroll;
            scroll-snap-type: x mandatory;
            width: 100vw; /* 뷰포트 너비에 맞춤 */
            max-width: 400px; /* 최대 너비 제한 */
            height: 100%;
            scroll-behavior: smooth;
            -ms-overflow-style: none; 
            scrollbar-width: none;  
        }

        .slider::-webkit-scrollbar {
            display: none; 
        }

        .screen {
            flex-shrink: 0;
            width: 100vw; /* 뷰포트 너비에 맞춤 */
            scroll-snap-align: start;
            text-align: center;
        }

        .question {
            margin-top: 30vh;
            font-size: 22px;
            color: #333333;
        }

        .options {
            margin-top: 40px;
        }

        .option-button {
            display: block;
            width: 80%;
            max-width: 300px;
            padding: 15px 0;
            margin: 10px auto;
            font-size: 18px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: #ffffff;
            color: #333333;
        }

        .option-button.selected {
            border-color: #D0273B;
            color: #D0273B;
        }

        /* 인디케이터 스타일 */
        .indicator {
            display: flex;
            justify-content: center;
            margin-top: 17vh; /* 기본 여백 */
            margin-bottom: 20px; 
        }

        .indicator div {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ccc; 
            margin: 0 5px; 
        }

        .indicator div.active {
            background-color: #D0273B; 
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ccc; 
            margin: 0 5px; 
        }

        .dot.active {
            background-color: #D0273B; 
        }

        .next-button {
            bottom : env(safe-area-inset-bottom,0); 
            left :0 ; 
            width :100%; 
            max-width:none ; 
            padding-bottom :15px ;
            padding-top :15px ;
            background-color: #D0273B;
            color:white ;
            text-align:center ;
        }

        /* 반응형 레이아웃 */
        @media (max-width: 480px) { /* 작은 화면 (모바일) */
            .question {
                font-size: 20px; /* 작은 폰트 크기 */
            }
            .option-button {
                font-size: 16px; /* 버튼 폰트 크기 축소 */
                padding: 10px; /* 버튼 패딩 축소 */
            }
            .indicator {
                margin-top: 10vh; /* 더 작은 여백 */
            }
        }
      
        @media (min-width: 481px) and (max-width: 768px) { /* 중간 화면 (태블릿) */
            .question {
                font-size: 20px; /* 중간 폰트 크기 */
            }
            .option-button {
                font-size: 18px; /* 중간 버튼 폰트 크기 */
                padding: 12px; /* 중간 버튼 패딩 */
            }
            .indicator {
                margin-top: 15vh; /* 중간 여백 */
            }
        }
        
        @media (min-width: 769px) { /* 큰 화면 (데스크탑) */
            .question {
                font-size: 22px; /* 기본 폰트 크기 유지 */
            }
            .option-button {
                font-size: 20px; /* 큰 버튼 폰트 크기 */
                padding: 15px; /* 기본 버튼 패딩 유지 */
            }
        }

    </style>
</head>
<body>

<div class="slider" id="slider" aria-live="polite">
    <!-- 첫 번째 화면 -->
    <div class="screen">
        <div class="question">어떤 종류의 와인을 가장 선호하시나요?</div>
        <div class="options">
            <button class="option-button">맥주</button>
            <button class="option-button">와인</button>
            <button class="option-button">칵테일</button>
            <button class="option-button">위스키</button>
            <button class="option-button">보드카</button>
            <button class="option-button">진</button>
        </div>
    </div>
    
    <!-- 두 번째 화면 -->
    <div class="screen">
        <div class="question">와인의 어떤 당도를 선호하시나요?</div>
        <div class="options">
            <button class="option-button">드라이</button>
            <button class="option-button">미디엄</button>
            <button class="option-button">스위트</button>
        </div>
    </div>

</div>

<div class="indicator" id="indicator">
    <div class="dot"></div>
    <div class="dot"></div>
</div>

<!-- 다음 버튼 -->
<div id="next-btn" class="next-button">다음</div>

<script>
    // 슬라이더의 스크롤 위치에 따라 인디케이터 업데이트
    const slider = document.getElementById('slider');
    const dots = document.querySelectorAll('.dot');
    const nextButton = document.getElementById('next-btn');
    let isScrolling = false;

    // 선택된 옵션 버튼을 저장할 배열
    const selectedOptions = [];

    // 슬라이더가 스크롤될 때 인디케이터 업데이트
    slider.addEventListener('scroll', function() {
        if (!isScrolling) {
            window.requestAnimationFrame(() => {
                
            // 현재 스크롤 위치 계산
            const scrollPosition = slider.scrollLeft;

            // 한 화면의 너비 가져오기
            const sliderWidth = slider.clientWidth;

            // 현재 화면 인덱스 계산
            const currentIndex = Math.round(scrollPosition / sliderWidth);

            // 인디케이터 업데이트
            dots.forEach((dot, index) => {
                    if (index === currentIndex) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
            });

            
                // 마지막 화면에 도달하면 버튼 텍스트를 '완료'로 변경
                if (currentIndex === dots.length - 1) {
                    nextButton.textContent = '완료';
                    
                } else {
                    nextButton.textContent = '다음';
                    
                }

            // 스크롤 플래그 초기화
            isScrolling = false; 
        });
    }
    // 스크롤 플래그 설정
    isScrolling = true; 
    });

    // 첫 번째 도트를 활성화 상태로 초기화
    dots[0].classList.add('active');

    // 옵션 버튼 클릭 시 'selected' 클래스 추가
    document.querySelectorAll('.option-button').forEach(button => {

        // 각 버튼에 클릭 이벤트 리스너 추가
        button.addEventListener('click', function() {

            // 모든 버튼에서 'selected' 클래스 제거
            document.querySelectorAll('.option-button').forEach(btn => btn.classList.remove('selected'));

            // 클릭된 버튼에 'selected' 클래스 추가
            this.classList.add('selected');

            // 선택된 옵션 저장 (질문별로 구분)
            const questionIndex = Math.round(slider.scrollLeft / slider.clientWidth);
            selectedOptions[questionIndex] = this.textContent;
        });
    });
    
    // 다음 버튼 클릭 시 처리 로직 추가
    nextButton.addEventListener('click', function() {
        if (nextButton.textContent === '완료') {

            // 완료 상태일 때 콘솔에 선택된 옵션 출력
            // console.log("선택된 옵션들:", selectedOptions);

            // 완료 상태일 때 /drink_survey로 이동
            window.location.href = `/drink_survey/$selectedOptions[0]`;

            // 좋아하는 주류를 선택할 수 있는 페이지로 이동
            if (selectedOptions.length > 0) {
                window.location.href = `/drink_survey/${encodeURIComponent(selectedOptions[0])}`;
            } else {

            }
            
        } else {
            // 다음 화면으로 스크롤 이동 (현재 화면 너비만큼 오른쪽으로)
            slider.scrollBy({
                left: slider.clientWidth,
                behavior: 'smooth'
            });
        }
    });
</script>

</body>
</html>